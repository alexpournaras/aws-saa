# ⚖️ AWS Elastic Load Balancing (ELB) & Auto Scaling

## 🧩 Scalability Overview

### 📈 Vertical Scalability (Scale Up / Down)
- Increase the **size** of an instance (e.g., `t2.micro → t2.large`)
- Typically used for **databases**
- **hardware limit**

### 🌐 Horizontal Scalability (Scale Out / In): AWS Elasticity
- Increase the **number of instances**
- Requires **distributed application architecture**

### 🧭 High Availability
- Closely tied to **horizontal scaling**
- Deploy instances in **at least two Availability Zones (AZs)**
- Ensures system survives an **AZ failures**

---

## ⚙️ Load Balancers

A **Load Balancer** is a service that **forwards incoming traffic** across multiple servers to enhance **availability** and **performance**.

---

## 🧠 Application Load Balancer (ALB)

### 📡 Layer 7 (HTTP/HTTPS/WebSocket)
- Supports **HTTP**, **HTTPS**, and **WebSocket** protocols
- Can route based on:
  - **Path:** `example.com/users`
  - **Hostname:** `test.example.com`
  - **Query String:** `example.com/users?id=123`

### 🧱 Target Groups
- EC2 Instances  
- ECS Tasks  
- Lambda Functions  
- Private IP Addresses  

### ⚡ Features
- Ideal for **microservices** and **container-based applications**
- Can route to **multiple target groups**
- **Health checks** are configured at the target group level
- Provides a **fixed DNS name**:  
  `xxxx.region.elb.amazonaws.com`
- Client IP accessible via headers:
  - `X-Forwarded-For`
  - `X-Forwarded-Port`
  - `X-Forwarded-Proto`

---

## 🌐 Network Load Balancer (NLB)

### ⚡ Layer 4 (Transport Layer)
- Handles **TCP**, **UDP**, and **TLS (secure TCP)**
- Supports **millions of requests per second**
- **Ultra-low latency**
- Provides **one static IP per AZ** (can use **Elastic IP**)

### 🧱 Target Groups
- EC2 Instances  
- Private IP Addresses  
- Application Load Balancers  

### 🔍 Health Checks
- Supports **TCP**, **HTTP**, and **HTTPS**

---

## 🔒 Gateway Load Balancer (GWLB)

### 🧩 Layer 3 (Network Layer)
- Designed for **security and inspection appliances**
- Use cases:
  - Firewalls
  - Intrusion Detection / Prevention Systems (IDS/IPS)
  - Deep Packet Inspection (DPI)
  - Payload analysis & manipulation
- Uses **GENEVE protocol (port 6081)**
- For traffic that needs to go first to some 3rd party security virtual applicances (perhaps to inspect packets)

### 🧱 Target Groups
- EC2 Instances  
- Private IP Addresses  

---

## 🛡️ Security Group Configuration

| Component | Inbound Rules | Notes |
|------------|----------------|-------|
| **Load Balancer** | HTTP (80) / HTTPS (443) from `0.0.0.0/0` | Public access |
| **EC2 Instances** | HTTP (80) from Load Balancer’s security group | Restricted internal access |

---

## 🍪 Sticky Sessions (Session Affinity)

### 🎯 Purpose
Ensures that the **same client** is always routed to the **same instance** behind the load balancer.

- Implemented via **cookies**
- Prevents session loss for stateful applications
- May cause **uneven load distribution**

### 🍪 Types of Sticky Sessions

#### Application-Based Cookies
- **Custom Cookie:** Generated by target (not AWSALB, AWSALBAPP, AWSALBTG)
- **Application Cookie:** Generated by the ALB (`AWSALBAPP`)

#### Duration-Based Cookies
- Generated by the **Load Balancer** (`AWSALB`)
- Maintains session for a defined **time period**

---

## ⚖️ Cross-Zone Load Balancing

### ✅ Enabled
- Each instance across all AZs receives an **equal share** of traffic.

### 🚫 Disabled
- Traffic distributed **per AZ**, not per instance.

| Load Balancer | Default State | Billing Notes |
|----------------|----------------|----------------|
| **ALB** | Enabled by default, can be disabled from the target group | No extra charges |
| **NLB & GWLB** | Disabled by default | Extra cost if enabled |

---

## 🔐 SSL / TLS Certificates

Allow traffic to be **encrypted in-transit** (in-flight) for secure communication.

### 🔒 Concepts
- **SSL (Secure Sockets Layer)** → older protocol  
- **TLS (Transport Layer Security)** → newer, modern version. Community still refer to this as SSL.  
- Certificates are **X.509** protocol  
- Managed via **AWS Certificate Manager (ACM)**

### 🧾 Certificate Management
- Obtain from **Certificate Authorities (CA)** (e.g., Let’s Encrypt, GoDaddy)
- Upload our own or generate in **ACM**
- Attach to **HTTPS listeners** on load balancers
- Support for **multiple SSL certificates** via **SNI (Server Name Indication)**

> 💡 Example:  
> `api.movies.com` and `movies.com` can each have **different SSL certificates** served by the same ALB thanks to the SNI.

---

## ⏳ Connection Draining (Deregistration Delay)

Allows active connections to **complete gracefully** before an instance is removed from the load balancer (unhealthy).

- ELB **stops sending new requests** to a draining instance
- **Waits** for existing connections to finish
- Prevents user disruption during scaling or maintenance

### ⚙️ Configuration
- Range: **0–3600 seconds**  
- Default: **300 seconds (5 minutes)**

---

## 🚀 Auto Scaling Groups (ASG)

Automatically adjusts the **number of EC2 instances** to meet current demand.

### ⚙️ Key Features
- **Scale out** to handle increased load  
- **Scale in** to reduce capacity  
- Automatically **registers new instances** to load balancers  
- **Recreates** unhealthy instances  
- **Free** AWS service (you only pay for EC2 instances)

---

## 🧱 Launch Template Configuration
Contains settings used by ASG:
- AMI ID  
- Instance Type  
- EC2 User Data  
- EBS Volumes  
- Security Groups  
- SSH Key Pair  
- IAM Role  
- Network Settings  
- Load Balancer Association  

### 📊 Scaling Configuration
- **Minimum size**
- **Maximum size**
- **Desired capacity (initial instances)**

---

## 📈 Scaling Policies

### ⚡ Dynamic Scaling
- Triggered by **CloudWatch alarms** or metrics (e.g., Average CPU Utilization)
- Types:
  - **Target Tracking:** Maintain metric at a target value
  - **Simple Scaling:** Scale when threshold reached
  - **Step Scaling:** Scale by steps based on metric levels

### 🗓️ Scheduled Scaling
- Triggered at **specific times** (e.g., increase capacity on weekends)

### 🔮 Predictive Scaling
- Uses **machine learning** to forecast capacity needs based on past trends/data.

---

## 🧘 Scaling Cooldown

- Period during which ASG **pauses scaling actions** (default **300 seconds**)
- Prevents launch or termination of instances to allow metrics to stabilize.

> 💡 **Tip:** Use **preconfigured AMIs** to reduce instance initialization time, serve traffic faster, and shorten cooldown periods.

---

✨ **Final Tip:** Combine **Load Balancers**, **Auto Scaling**, and **multi-AZ deployment** to achieve a fault-tolerant, self-healing, and highly available AWS infrastructure.
